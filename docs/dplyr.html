<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 6 Tidyverse: dplyr | Data analysis using R for Psychology and Social Science</title>
<meta name="author" content="Alexander (Sasha) Pastukhov">
<meta name="description" content="Now that you understand vectors, tables, functions and pipes, and you know what our end goal is (a tidy table), we can start with data wrangling and Tidyverse way of doing it. All functions...">
<meta name="generator" content="bookdown 0.35 with bs4_book()">
<meta property="og:title" content="Chapter 6 Tidyverse: dplyr | Data analysis using R for Psychology and Social Science">
<meta property="og:type" content="book">
<meta property="og:description" content="Now that you understand vectors, tables, functions and pipes, and you know what our end goal is (a tidy table), we can start with data wrangling and Tidyverse way of doing it. All functions...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 6 Tidyverse: dplyr | Data analysis using R for Psychology and Social Science">
<meta name="twitter:description" content="Now that you understand vectors, tables, functions and pipes, and you know what our end goal is (a tidy table), we can start with data wrangling and Tidyverse way of doing it. All functions...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.5.1/transition.js"></script><script src="libs/bs3compat-0.5.1/tabs.js"></script><script src="libs/bs3compat-0.5.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><!-- Google tag (gtag.js) --><script async src="https://www.googletagmanager.com/gtag/js?id=G-QMVBLBE7DV"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-QMVBLBE7DV');
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="bs4_style.css">
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Data analysis using R for Psychology and Social Science</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Introduction</a></li>
<li><a class="" href="software.html">Software</a></li>
<li><a class="" href="reproducable-research.html"><span class="header-section-number">1</span> Reproducable Research: Projects and Markdown Notebooks</a></li>
<li><a class="" href="vectors.html"><span class="header-section-number">2</span> Vectors! Vectors everywhere!</a></li>
<li><a class="" href="tables.html"><span class="header-section-number">3</span> Tables and Tibbles (and Tribbles)</a></li>
<li><a class="" href="functions.html"><span class="header-section-number">4</span> Functions! Functions everywhere!</a></li>
<li><a class="" href="ggplot2.html"><span class="header-section-number">5</span> ggplot2: Grammar of Graphics</a></li>
<li><a class="active" href="dplyr.html"><span class="header-section-number">6</span> Tidyverse: dplyr</a></li>
<li><a class="" href="working-with-factors.html"><span class="header-section-number">7</span> Working with Factors</a></li>
<li><a class="" href="tyding.html"><span class="header-section-number">8</span> Tidyng your data: joins and pivots</a></li>
<li><a class="" href="control-flow-chapter.html"><span class="header-section-number">9</span> Controling computation flow</a></li>
<li><a class="" href="missing-data.html"><span class="header-section-number">10</span> Missing data</a></li>
<li><a class="" href="strings.html"><span class="header-section-number">11</span> Working with strings</a></li>
<li><a class="" href="sampling-and-simulations.html"><span class="header-section-number">12</span> Sampling and simulations</a></li>
<li><a class="" href="generalized-linear-regression-and-resampling.html"><span class="header-section-number">13</span> (Generalized) Linear regression and Resampling</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/alexander-pastukhov/data-analysis-using-r-for-psychology">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="dplyr" class="section level1" number="6">
<h1>
<span class="header-section-number">6</span> Tidyverse: dplyr<a class="anchor" aria-label="anchor" href="#dplyr"><i class="fas fa-link"></i></a>
</h1>
<p>Now that you understand vectors, tables, functions and pipes, and you know what our end goal is (a tidy table), we can start with data wrangling and Tidyverse way of doing it. All functions discussed below are part of <a href="https://dplyr.tidyverse.org/">dplyr</a><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;The name should invoke an image of data pliers. According to Hadley Wickham, you can pronounce it any way you like.&lt;/p&gt;"><sup>46</sup></a> “grammar of data manipulation” package. Grab the <a href="notebooks/Seminar%2006%20-%20dplyr.qmd">exercise notebook</a>!</p>
<div id="tidyverse-philosophy" class="section level2" number="6.1">
<h2>
<span class="header-section-number">6.1</span> Tidyverse philosophy<a class="anchor" aria-label="anchor" href="#tidyverse-philosophy"><i class="fas fa-link"></i></a>
</h2>
<p>Data analysis is different from “normal” programming as it mostly involves a series of sequential operations on the same table. You might load the table, transform some variables, filter data, select smaller subset of columns, aggregate by summarizing across different groups of variables before plotting it or formally analyzing it via statistical tests. Tidyverse is built around this serial nature of data analysis of piping a table through a chain of functions. Accordingly, Tidyverse functions take a <em>table</em> (<code>data.frame</code> or <code>tibble</code>) as their <em>first</em> parameter, which makes piping simpler, and return a <em>modified table</em> as an output. This <em>table-in → table-out</em> consistency makes it easy to pipe these operations one after another. For me, it helps to think about Tidyverse functions as <em>verbs</em>: Actions that I perform on the table at each step.</p>
<p>Here is quick teaser of how such sequential piping works. Below, we will examine each verb/function separately and I will also show you how same operations can be carried out using base R. Note that I put each verb/function on a separate line. I don’t need to do this, but it makes it easier to understand how many different operations you perform (number of lines), how complex they are (how long individuals lines of code are), and makes them easy to read line-by-line. Note that even though we have many lines, it is fairly easy to follow the entire code sequence.</p>
<div class="sourceCode" id="cb257"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># miles-per-gallon to kilometers-per-liter conversion factor</span></span>
<span><span class="va">mpg2kpl</span> <span class="op">&lt;-</span> <span class="fl">2.82481061</span></span>
<span></span>
<span><span class="va">mpg</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># we filter the table by rows, </span></span>
<span>  <span class="co"># only keeping rows for which year is 2008</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2008</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  </span>
<span>  <span class="co"># we change cty and hwy columns by turning</span></span>
<span>  <span class="co"># miles/gallon into liters/kilometer</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>cty_kpl <span class="op">=</span> <span class="va">cty</span> <span class="op">/</span> <span class="va">mpg2kpl</span>,</span>
<span>         hwy_kpl <span class="op">=</span> <span class="va">hwy</span> <span class="op">/</span> <span class="va">mpg2kpl</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  </span>
<span>  <span class="co"># we create a new column by computing an </span></span>
<span>  <span class="co"># average efficiency as mean between city and highway cycles</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>avg_kpl <span class="op">=</span> <span class="op">(</span><span class="va">cty_kpl</span> <span class="op">+</span> <span class="va">hwy_kpl</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  </span>
<span>  <span class="co"># we convert kilometers-per-liter to liters for 100 KM</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>avg_for_100 <span class="op">=</span> <span class="fl">100</span> <span class="op">/</span> <span class="va">avg_kpl</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  </span>
<span>  <span class="co"># we reduce the table to only two columns</span></span>
<span>  <span class="co"># class (of car) and avg_mpg</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">class</span>, <span class="va">avg_for_100</span><span class="op">)</span>  <span class="op">|&gt;</span></span>
<span></span>
<span>  <span class="co"># we group by each class of car</span></span>
<span>  <span class="co"># and compute average efficiency for each group (class of car)</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">class</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>class_avg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">avg_for_100</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"keep"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  </span>
<span>  <span class="co"># we round the value to just one digit after the decimal point</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>class_avg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">class_avg</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  </span>
<span>  <span class="co"># we sort table rows to go from best to worst on efficiency</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">class_avg</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  </span>
<span>  <span class="co"># we rename the class_avg_lpk to have a more meaningul name</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span><span class="st">"Average liters per 100 KM"</span> <span class="op">=</span> <span class="va">class_avg</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span></span>
<span>  <span class="co"># we kable (Knit the tABLE) to make it look nicer in the document</span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">class</th>
<th align="right">Average liters per 100 KM</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">compact</td>
<td align="right">11.6</td>
</tr>
<tr class="even">
<td align="left">midsize</td>
<td align="right">12.0</td>
</tr>
<tr class="odd">
<td align="left">subcompact</td>
<td align="right">12.6</td>
</tr>
<tr class="even">
<td align="left">2seater</td>
<td align="right">14.0</td>
</tr>
<tr class="odd">
<td align="left">minivan</td>
<td align="right">15.3</td>
</tr>
<tr class="even">
<td align="left">suv</td>
<td align="right">18.1</td>
</tr>
<tr class="odd">
<td align="left">pickup</td>
<td align="right">19.5</td>
</tr>
</tbody>
</table></div>
</div>
<div id="select" class="section level2" number="6.2">
<h2>
<span class="header-section-number">6.2</span> <code>select()</code> columns by name<a class="anchor" aria-label="anchor" href="#select"><i class="fas fa-link"></i></a>
</h2>
<p><a href="https://dplyr.tidyverse.org/reference/select.html">Select</a> verb allows you to select/pick columns in a table using their names. This is very similar to using columns names as indexes for tables that you have learned in <a href="#table-indexing">seminar 3</a>.</p>
<p>First, let us make a shorter version of <code>mpg</code> table by keeping only the first five rows. Note that you can also pick first N rows via <a href="https://stat.ethz.ch/R-manual/R-devel/library/utils/html/head.html">head()</a> function or <a href="https://dplyr.tidyverse.org/reference/slice.html">slide_head()</a> function from <a href="https://dplyr.tidyverse.org/">dplyr</a> itself .</p>
<div class="sourceCode" id="cb258"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">short_mpg</span> <span class="op">&lt;-</span> <span class="va">mpg</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># same "first five rows" but via head() function</span></span>
<span><span class="va">short_mpg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">mpg</span>, <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># same "first five rows" but via dplyr::slice_head() function</span></span>
<span><span class="va">short_mpg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_head</a></span><span class="op">(</span><span class="va">mpg</span>, n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">short_mpg</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<colgroup>
<col width="19%">
<col width="8%">
<col width="8%">
<col width="7%">
<col width="5%">
<col width="16%">
<col width="5%">
<col width="5%">
<col width="5%">
<col width="4%">
<col width="11%">
</colgroup>
<thead><tr class="header">
<th align="left">manufacturer</th>
<th align="left">model</th>
<th align="right">displ</th>
<th align="right">year</th>
<th align="right">cyl</th>
<th align="left">trans</th>
<th align="left">drv</th>
<th align="right">cty</th>
<th align="right">hwy</th>
<th align="left">fl</th>
<th align="left">class</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">audi</td>
<td align="left">a4</td>
<td align="right">1.8</td>
<td align="right">1999</td>
<td align="right">4</td>
<td align="left">auto(l5)</td>
<td align="left">f</td>
<td align="right">18</td>
<td align="right">29</td>
<td align="left">p</td>
<td align="left">compact</td>
</tr>
<tr class="even">
<td align="left">audi</td>
<td align="left">a4</td>
<td align="right">1.8</td>
<td align="right">1999</td>
<td align="right">4</td>
<td align="left">manual(m5)</td>
<td align="left">f</td>
<td align="right">21</td>
<td align="right">29</td>
<td align="left">p</td>
<td align="left">compact</td>
</tr>
<tr class="odd">
<td align="left">audi</td>
<td align="left">a4</td>
<td align="right">2.0</td>
<td align="right">2008</td>
<td align="right">4</td>
<td align="left">manual(m6)</td>
<td align="left">f</td>
<td align="right">20</td>
<td align="right">31</td>
<td align="left">p</td>
<td align="left">compact</td>
</tr>
<tr class="even">
<td align="left">audi</td>
<td align="left">a4</td>
<td align="right">2.0</td>
<td align="right">2008</td>
<td align="right">4</td>
<td align="left">auto(av)</td>
<td align="left">f</td>
<td align="right">21</td>
<td align="right">30</td>
<td align="left">p</td>
<td align="left">compact</td>
</tr>
<tr class="odd">
<td align="left">audi</td>
<td align="left">a4</td>
<td align="right">2.8</td>
<td align="right">1999</td>
<td align="right">6</td>
<td align="left">auto(l5)</td>
<td align="left">f</td>
<td align="right">16</td>
<td align="right">26</td>
<td align="left">p</td>
<td align="left">compact</td>
</tr>
</tbody>
</table></div>
<p>Here is how you can select only <code>model</code> and <code>cty</code> columns via preserving <code>[]</code> subsetting</p>
<div class="sourceCode" id="cb259"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">short_mpg</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"model"</span>, <span class="st">"cty"</span><span class="op">)</span><span class="op">]</span> </span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">model</th>
<th align="right">cty</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">a4</td>
<td align="right">18</td>
</tr>
<tr class="even">
<td align="left">a4</td>
<td align="right">21</td>
</tr>
<tr class="odd">
<td align="left">a4</td>
<td align="right">20</td>
</tr>
<tr class="even">
<td align="left">a4</td>
<td align="right">21</td>
</tr>
<tr class="odd">
<td align="left">a4</td>
<td align="right">16</td>
</tr>
</tbody>
</table></div>
<p>And here is how it is done via <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code>.</p>
<div class="sourceCode" id="cb260"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">short_mpg</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">cty</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">model</th>
<th align="right">cty</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">a4</td>
<td align="right">18</td>
</tr>
<tr class="even">
<td align="left">a4</td>
<td align="right">21</td>
</tr>
<tr class="odd">
<td align="left">a4</td>
<td align="right">20</td>
</tr>
<tr class="even">
<td align="left">a4</td>
<td align="right">21</td>
</tr>
<tr class="odd">
<td align="left">a4</td>
<td align="right">16</td>
</tr>
</tbody>
</table></div>
<p>The idea of Tidyverse functions is to adopt to you, so you <em>can</em> use quotes or pass a vector of strings with column names. All calls below produce the same effect, so pick the style you prefer (mine, is in the code <em>above</em>) and stick to it<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;In general, bad but consistent styling is better than an inconsistent mix of good styles.&lt;/p&gt;"><sup>47</sup></a>.</p>
<div class="sourceCode" id="cb261"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">short_mpg</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"model"</span>, <span class="st">"cty"</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span><span class="va">short_mpg</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="st">"model"</span>, <span class="st">"cty"</span><span class="op">)</span></span>
<span>  </span>
<span><span class="va">short_mpg</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">cty</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>As you surely remember, you can use negation to select <em>other</em> indexes within a vector (<code>c(4, 5, 6)[-2]</code> gives you <code>[4, 6]</code>). For the single brackets <code>[]</code> this mechanism does not work with column <em>names</em> (only with their indexes). However, <code>select</code> has you covered, so we can select everything <em>but</em> <code>cty</code> and <code>model</code></p>
<div class="sourceCode" id="cb262"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">short_mpg</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">cty</span>, <span class="op">-</span><span class="va">model</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">manufacturer</th>
<th align="right">displ</th>
<th align="right">year</th>
<th align="right">cyl</th>
<th align="left">trans</th>
<th align="left">drv</th>
<th align="right">hwy</th>
<th align="left">fl</th>
<th align="left">class</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">audi</td>
<td align="right">1.8</td>
<td align="right">1999</td>
<td align="right">4</td>
<td align="left">auto(l5)</td>
<td align="left">f</td>
<td align="right">29</td>
<td align="left">p</td>
<td align="left">compact</td>
</tr>
<tr class="even">
<td align="left">audi</td>
<td align="right">1.8</td>
<td align="right">1999</td>
<td align="right">4</td>
<td align="left">manual(m5)</td>
<td align="left">f</td>
<td align="right">29</td>
<td align="left">p</td>
<td align="left">compact</td>
</tr>
<tr class="odd">
<td align="left">audi</td>
<td align="right">2.0</td>
<td align="right">2008</td>
<td align="right">4</td>
<td align="left">manual(m6)</td>
<td align="left">f</td>
<td align="right">31</td>
<td align="left">p</td>
<td align="left">compact</td>
</tr>
<tr class="even">
<td align="left">audi</td>
<td align="right">2.0</td>
<td align="right">2008</td>
<td align="right">4</td>
<td align="left">auto(av)</td>
<td align="left">f</td>
<td align="right">30</td>
<td align="left">p</td>
<td align="left">compact</td>
</tr>
<tr class="odd">
<td align="left">audi</td>
<td align="right">2.8</td>
<td align="right">1999</td>
<td align="right">6</td>
<td align="left">auto(l5)</td>
<td align="left">f</td>
<td align="right">26</td>
<td align="left">p</td>
<td align="left">compact</td>
</tr>
</tbody>
</table></div>
<p>In the current version of <code>dplyr</code>, you can do the same negation via <code>!</code> (a <code>logical not</code> operator, you will meet later), moreover, it is now a recommended way of writing the selection<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;At least, &lt;code&gt;-&lt;/code&gt; is not mentioned anymore, even though it still works.&lt;/p&gt;"><sup>48</sup></a>. The <code>-</code> and <code>!</code> are not synonyms and the difference is subtle but important, see below.</p>
<div class="sourceCode" id="cb263"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This will NOT produce the same result as above</span></span>
<span><span class="co"># Note that the model column is still in the table</span></span>
<span><span class="va">short_mpg</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">!</span><span class="va">cty</span>, <span class="op">!</span><span class="va">model</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<colgroup>
<col width="19%">
<col width="8%">
<col width="8%">
<col width="7%">
<col width="5%">
<col width="16%">
<col width="5%">
<col width="5%">
<col width="4%">
<col width="11%">
<col width="5%">
</colgroup>
<thead><tr class="header">
<th align="left">manufacturer</th>
<th align="left">model</th>
<th align="right">displ</th>
<th align="right">year</th>
<th align="right">cyl</th>
<th align="left">trans</th>
<th align="left">drv</th>
<th align="right">hwy</th>
<th align="left">fl</th>
<th align="left">class</th>
<th align="right">cty</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">audi</td>
<td align="left">a4</td>
<td align="right">1.8</td>
<td align="right">1999</td>
<td align="right">4</td>
<td align="left">auto(l5)</td>
<td align="left">f</td>
<td align="right">29</td>
<td align="left">p</td>
<td align="left">compact</td>
<td align="right">18</td>
</tr>
<tr class="even">
<td align="left">audi</td>
<td align="left">a4</td>
<td align="right">1.8</td>
<td align="right">1999</td>
<td align="right">4</td>
<td align="left">manual(m5)</td>
<td align="left">f</td>
<td align="right">29</td>
<td align="left">p</td>
<td align="left">compact</td>
<td align="right">21</td>
</tr>
<tr class="odd">
<td align="left">audi</td>
<td align="left">a4</td>
<td align="right">2.0</td>
<td align="right">2008</td>
<td align="right">4</td>
<td align="left">manual(m6)</td>
<td align="left">f</td>
<td align="right">31</td>
<td align="left">p</td>
<td align="left">compact</td>
<td align="right">20</td>
</tr>
<tr class="even">
<td align="left">audi</td>
<td align="left">a4</td>
<td align="right">2.0</td>
<td align="right">2008</td>
<td align="right">4</td>
<td align="left">auto(av)</td>
<td align="left">f</td>
<td align="right">30</td>
<td align="left">p</td>
<td align="left">compact</td>
<td align="right">21</td>
</tr>
<tr class="odd">
<td align="left">audi</td>
<td align="left">a4</td>
<td align="right">2.8</td>
<td align="right">1999</td>
<td align="right">6</td>
<td align="left">auto(l5)</td>
<td align="left">f</td>
<td align="right">26</td>
<td align="left">p</td>
<td align="left">compact</td>
<td align="right">16</td>
</tr>
</tbody>
</table></div>
<p>However, if you stick to putting all column names into a vector, as with the direct selection above, you can use negation with names as strings, you can negate a vector of names, etc. Again, it is mostly a matter of taste with consistency being more important than a specific choice you make.</p>
<div class="sourceCode" id="cb264"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># will produce the same result as for "-"</span></span>
<span><span class="va">short_mpg</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"cty"</span>, <span class="st">"model"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">short_mpg</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">!</span><span class="st">"cty"</span>, <span class="op">!</span><span class="st">"model"</span><span class="op">)</span></span>
<span>  </span>
<span><span class="va">short_mpg</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">cty</span>, <span class="va">model</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Unlike vector indexing that forbids mixing positive and negative indexing, <code>select</code> does allow it. However, <strong>do not use it</strong><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;Unless you know what you are doing and that is the simplest and clearest way to achieve this.&lt;/p&gt;"><sup>49</sup></a> because results can be fairly counter-intuitive and, on top of that, <code>-</code> and <code>!</code> work somewhat differently. Note the difference between <code>!</code> and <code>-</code>: In the former case only the <code>!model</code> part appears to have the effect, whereas in case of <code>-</code> only <code>cty</code> works.</p>
<div class="sourceCode" id="cb265"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">short_mpg</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">cty</span>, <span class="op">!</span><span class="va">model</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table style="width:100%;" class="table table-sm">
<colgroup>
<col width="6%">
<col width="20%">
<col width="9%">
<col width="8%">
<col width="6%">
<col width="17%">
<col width="6%">
<col width="6%">
<col width="4%">
<col width="12%">
</colgroup>
<thead><tr class="header">
<th align="right">cty</th>
<th align="left">manufacturer</th>
<th align="right">displ</th>
<th align="right">year</th>
<th align="right">cyl</th>
<th align="left">trans</th>
<th align="left">drv</th>
<th align="right">hwy</th>
<th align="left">fl</th>
<th align="left">class</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">18</td>
<td align="left">audi</td>
<td align="right">1.8</td>
<td align="right">1999</td>
<td align="right">4</td>
<td align="left">auto(l5)</td>
<td align="left">f</td>
<td align="right">29</td>
<td align="left">p</td>
<td align="left">compact</td>
</tr>
<tr class="even">
<td align="right">21</td>
<td align="left">audi</td>
<td align="right">1.8</td>
<td align="right">1999</td>
<td align="right">4</td>
<td align="left">manual(m5)</td>
<td align="left">f</td>
<td align="right">29</td>
<td align="left">p</td>
<td align="left">compact</td>
</tr>
<tr class="odd">
<td align="right">20</td>
<td align="left">audi</td>
<td align="right">2.0</td>
<td align="right">2008</td>
<td align="right">4</td>
<td align="left">manual(m6)</td>
<td align="left">f</td>
<td align="right">31</td>
<td align="left">p</td>
<td align="left">compact</td>
</tr>
<tr class="even">
<td align="right">21</td>
<td align="left">audi</td>
<td align="right">2.0</td>
<td align="right">2008</td>
<td align="right">4</td>
<td align="left">auto(av)</td>
<td align="left">f</td>
<td align="right">30</td>
<td align="left">p</td>
<td align="left">compact</td>
</tr>
<tr class="odd">
<td align="right">16</td>
<td align="left">audi</td>
<td align="right">2.8</td>
<td align="right">1999</td>
<td align="right">6</td>
<td align="left">auto(l5)</td>
<td align="left">f</td>
<td align="right">26</td>
<td align="left">p</td>
<td align="left">compact</td>
</tr>
</tbody>
</table></div>
<div class="sourceCode" id="cb266"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">short_mpg</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">cty</span>, <span class="op">-</span><span class="va">model</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="right">cty</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">18</td>
</tr>
<tr class="even">
<td align="right">21</td>
</tr>
<tr class="odd">
<td align="right">20</td>
</tr>
<tr class="even">
<td align="right">21</td>
</tr>
<tr class="odd">
<td align="right">16</td>
</tr>
</tbody>
</table></div>
<p>To make things even, worse <code>select(-model, cty)</code> work the same way as <code>select(cty, !model)</code> (sigh…)</p>
<div class="sourceCode" id="cb267"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">short_mpg</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">model</span>, <span class="va">cty</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table style="width:100%;" class="table table-sm">
<colgroup>
<col width="20%">
<col width="9%">
<col width="8%">
<col width="6%">
<col width="17%">
<col width="6%">
<col width="6%">
<col width="6%">
<col width="4%">
<col width="12%">
</colgroup>
<thead><tr class="header">
<th align="left">manufacturer</th>
<th align="right">displ</th>
<th align="right">year</th>
<th align="right">cyl</th>
<th align="left">trans</th>
<th align="left">drv</th>
<th align="right">cty</th>
<th align="right">hwy</th>
<th align="left">fl</th>
<th align="left">class</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">audi</td>
<td align="right">1.8</td>
<td align="right">1999</td>
<td align="right">4</td>
<td align="left">auto(l5)</td>
<td align="left">f</td>
<td align="right">18</td>
<td align="right">29</td>
<td align="left">p</td>
<td align="left">compact</td>
</tr>
<tr class="even">
<td align="left">audi</td>
<td align="right">1.8</td>
<td align="right">1999</td>
<td align="right">4</td>
<td align="left">manual(m5)</td>
<td align="left">f</td>
<td align="right">21</td>
<td align="right">29</td>
<td align="left">p</td>
<td align="left">compact</td>
</tr>
<tr class="odd">
<td align="left">audi</td>
<td align="right">2.0</td>
<td align="right">2008</td>
<td align="right">4</td>
<td align="left">manual(m6)</td>
<td align="left">f</td>
<td align="right">20</td>
<td align="right">31</td>
<td align="left">p</td>
<td align="left">compact</td>
</tr>
<tr class="even">
<td align="left">audi</td>
<td align="right">2.0</td>
<td align="right">2008</td>
<td align="right">4</td>
<td align="left">auto(av)</td>
<td align="left">f</td>
<td align="right">21</td>
<td align="right">30</td>
<td align="left">p</td>
<td align="left">compact</td>
</tr>
<tr class="odd">
<td align="left">audi</td>
<td align="right">2.8</td>
<td align="right">1999</td>
<td align="right">6</td>
<td align="left">auto(l5)</td>
<td align="left">f</td>
<td align="right">16</td>
<td align="right">26</td>
<td align="left">p</td>
<td align="left">compact</td>
</tr>
</tbody>
</table></div>
<p>So, bottom line, do not mix positive and negative indexing in <code>select</code>! I am showing you this only to signal the potential danger.</p>
<div class="practice">
<p>Do exercise 1.</p>
</div>
<p>Simple names and their negation will be sufficient for most of your projects. However, I would recommend taking a look at the <a href="https://dplyr.tidyverse.org/reference/select.html">official manual</a> just to see that <code>select</code> offers a lot of flexibility (selecting range of columns, by column type, by partial name matching, etc), something that might be useful for you in your work.</p>
</div>
<div id="conditions" class="section level2" number="6.3">
<h2>
<span class="header-section-number">6.3</span> Conditions<a class="anchor" aria-label="anchor" href="#conditions"><i class="fas fa-link"></i></a>
</h2>
<p>Before we can work with the next verb, you need to understand conditions. Conditions are statements about values that are either <code>TRUE</code> or <code>FALSE</code>. In the simplest case, you can check whether two values (one in a variable and one hard-coded) are equal via <code>==</code> operator</p>
<div class="sourceCode" id="cb268"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">x</span> <span class="op">==</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb270"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">x</span> <span class="op">==</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<p>For numeric values, you can use all usual comparison operators including <em>not equal</em> <code>!=</code>, <em>less than</em> <code>&lt;</code>, <em>greater than</em> <code>&gt;</code>, <em>less than or equal to</em> <code>&lt;=</code> (note the order of symbols!), and <em>greater than or equal to</em> <code>&gt;=</code> (again, note the order of symbols).</p>
<div class="practice">
<p>Do exercise 2.</p>
</div>
<p>You can negate a statement via <em>not</em> <code>!</code> symbol as <code>!TRUE</code> is <code>FALSE</code> and vice versa. However, note that round brackets in the examples below! They are critical to express the <em>order</em> of computation. Anything <em>inside</em> the brackets is evaluated first. And if you have brackets inside the brackets, similar to nested functions, it is the innermost expression that get evaluated first. In the example below, <code>x==5</code> is evaluated first and logical inversion happens only after it. In this particular example, you may not need them but I would suggest using them to ensure clarity.</p>
<div class="sourceCode" id="cb272"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="va">x</span> <span class="op">==</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<div class="sourceCode" id="cb274"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="va">x</span> <span class="op">==</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="practice">
<p>Do exercise 3.</p>
</div>
<p>You can also combine several conditions using <em>and</em> <code>&amp;</code> and <em>or</em> <code>|</code> operators<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;There are also &lt;code&gt;&amp;amp;&amp;amp;&lt;/code&gt; and &lt;code&gt;||&lt;/code&gt; operators that work only on scalars, i.e., on single values only.&lt;/p&gt;"><sup>50</sup></a>. Again, note round brackets that explicitly define what is evaluated first.</p>
<div class="sourceCode" id="cb276"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span></span>
<span><span class="co"># x is not equal to 5 OR y is equal to 1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">(</span><span class="va">x</span> <span class="op">!=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">|</span> <span class="op">(</span><span class="va">y</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<div class="sourceCode" id="cb278"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># x less than 10 AND y is greater than or equal to 1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">(</span><span class="va">x</span> <span class="op">&lt;</span> <span class="fl">10</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">y</span> <span class="op">&gt;=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="practice">
<p>Do exercise 4.</p>
</div>
<p>All examples above used scalars but you remember that <em>everything is a vector</em>, including values that we used (they are just vectors of length one). Accordingly, same logic works for vectors of arbitrary length with comparisons working element-wise, so you get a vector of the same length with <code>TRUE</code> or <code>FALSE</code> values for each <em>pairwise</em> comparison.</p>
<div class="practice">
<p>Do exercise 5.</p>
</div>
</div>
<div id="logical-indexing" class="section level2" number="6.4">
<h2>
<span class="header-section-number">6.4</span> Logical indexing<a class="anchor" aria-label="anchor" href="#logical-indexing"><i class="fas fa-link"></i></a>
</h2>
<p>In the second seminar, you learned about vector indexing when you access <em>some</em> elements of a vector by specifying their index. There is an alternative way, called <em>logical indexing</em>. Here, you supply a vector of equal length with <em>logical values</em> and you get elements of the original vector whenever the logical value is <code>TRUE</code></p>
<div class="sourceCode" id="cb280"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span></span>
<span><span class="va">x</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<pre><code>## [1] 1 2 4</code></pre>
<p>This is particularly useful, if you are interested in elements that satisfy certain condition. For example, you want all <em>negative</em> values and you can use condition <code>x&lt;5</code> that will produce a vector of logical values that, in turn, can be used as index</p>
<div class="sourceCode" id="cb282"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="fl">5</span>, <span class="fl">3</span>, <span class="op">-</span><span class="fl">5</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">x</span><span class="op">[</span><span class="va">x</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">]</span></span></code></pre></div>
<pre><code>## [1] -2 -5 -1</code></pre>
<p>You can have conditions of any complexity by combining them via <em>and</em> <code>&amp;</code> and <em>or</em> <code>|</code> operators. For example, if you want number below -1 or above 3 (be careful to have space between <code>&lt;</code> and <code>-</code>, otherwise it will be interpreted as assignment <code>&lt;-</code>).</p>
<div class="sourceCode" id="cb284"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="fl">5</span>, <span class="fl">3</span>, <span class="op">-</span><span class="fl">5</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">x</span><span class="op">[</span><span class="op">(</span><span class="va">x</span> <span class="op">&lt;</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">|</span> <span class="op">(</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">3</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<pre><code>## [1] -2  5 -5</code></pre>
<div class="practice">
<p>Do exercise 6.</p>
</div>
<p>Sometimes you may want to know the actual index of elements for <em>which</em> some condition is <code>TRUE</code>. Function <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/which.html">which()</a> does exactly that.</p>
<div class="sourceCode" id="cb286"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="fl">5</span>, <span class="fl">3</span>, <span class="op">-</span><span class="fl">5</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span> <span class="op">(</span><span class="va">x</span><span class="op">&lt;</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">|</span> <span class="op">(</span><span class="va">x</span><span class="op">&gt;</span><span class="fl">3</span><span class="op">)</span> <span class="op">)</span></span></code></pre></div>
<pre><code>## [1] 1 2 4</code></pre>
</div>
<div id="filter-rows-by-values" class="section level2" number="6.5">
<h2>
<span class="header-section-number">6.5</span> <code>filter()</code> rows by values<a class="anchor" aria-label="anchor" href="#filter-rows-by-values"><i class="fas fa-link"></i></a>
</h2>
<p>Now that you understand conditions and logical indexing, using <a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a> is very straightforward: You simply put condition that describes rows that you want to <em>retain</em> inside the <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> call. For example, we can look at efficiency only for two-seater cars.</p>
<div class="sourceCode" id="cb288"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mpg</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">class</span> <span class="op">==</span> <span class="st">"2seater"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<colgroup>
<col width="18%">
<col width="12%">
<col width="8%">
<col width="7%">
<col width="5%">
<col width="15%">
<col width="5%">
<col width="5%">
<col width="5%">
<col width="4%">
<col width="11%">
</colgroup>
<thead><tr class="header">
<th align="left">manufacturer</th>
<th align="left">model</th>
<th align="right">displ</th>
<th align="right">year</th>
<th align="right">cyl</th>
<th align="left">trans</th>
<th align="left">drv</th>
<th align="right">cty</th>
<th align="right">hwy</th>
<th align="left">fl</th>
<th align="left">class</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">chevrolet</td>
<td align="left">corvette</td>
<td align="right">5.7</td>
<td align="right">1999</td>
<td align="right">8</td>
<td align="left">manual(m6)</td>
<td align="left">r</td>
<td align="right">16</td>
<td align="right">26</td>
<td align="left">p</td>
<td align="left">2seater</td>
</tr>
<tr class="even">
<td align="left">chevrolet</td>
<td align="left">corvette</td>
<td align="right">5.7</td>
<td align="right">1999</td>
<td align="right">8</td>
<td align="left">auto(l4)</td>
<td align="left">r</td>
<td align="right">15</td>
<td align="right">23</td>
<td align="left">p</td>
<td align="left">2seater</td>
</tr>
<tr class="odd">
<td align="left">chevrolet</td>
<td align="left">corvette</td>
<td align="right">6.2</td>
<td align="right">2008</td>
<td align="right">8</td>
<td align="left">manual(m6)</td>
<td align="left">r</td>
<td align="right">16</td>
<td align="right">26</td>
<td align="left">p</td>
<td align="left">2seater</td>
</tr>
<tr class="even">
<td align="left">chevrolet</td>
<td align="left">corvette</td>
<td align="right">6.2</td>
<td align="right">2008</td>
<td align="right">8</td>
<td align="left">auto(s6)</td>
<td align="left">r</td>
<td align="right">15</td>
<td align="right">25</td>
<td align="left">p</td>
<td align="left">2seater</td>
</tr>
<tr class="odd">
<td align="left">chevrolet</td>
<td align="left">corvette</td>
<td align="right">7.0</td>
<td align="right">2008</td>
<td align="right">8</td>
<td align="left">manual(m6)</td>
<td align="left">r</td>
<td align="right">15</td>
<td align="right">24</td>
<td align="left">p</td>
<td align="left">2seater</td>
</tr>
</tbody>
</table></div>
<p>You can use information from any row, so we can look for midsize cars with four-wheel drive.</p>
<div class="sourceCode" id="cb289"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mpg</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">class</span> <span class="op">==</span> <span class="st">"midsize"</span> <span class="op">&amp;</span> <span class="va">drv</span> <span class="op">==</span> <span class="st">"4"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table style="width:100%;" class="table table-sm">
<colgroup>
<col width="18%">
<col width="15%">
<col width="8%">
<col width="7%">
<col width="5%">
<col width="12%">
<col width="5%">
<col width="5%">
<col width="5%">
<col width="4%">
<col width="11%">
</colgroup>
<thead><tr class="header">
<th align="left">manufacturer</th>
<th align="left">model</th>
<th align="right">displ</th>
<th align="right">year</th>
<th align="right">cyl</th>
<th align="left">trans</th>
<th align="left">drv</th>
<th align="right">cty</th>
<th align="right">hwy</th>
<th align="left">fl</th>
<th align="left">class</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">audi</td>
<td align="left">a6 quattro</td>
<td align="right">2.8</td>
<td align="right">1999</td>
<td align="right">6</td>
<td align="left">auto(l5)</td>
<td align="left">4</td>
<td align="right">15</td>
<td align="right">24</td>
<td align="left">p</td>
<td align="left">midsize</td>
</tr>
<tr class="even">
<td align="left">audi</td>
<td align="left">a6 quattro</td>
<td align="right">3.1</td>
<td align="right">2008</td>
<td align="right">6</td>
<td align="left">auto(s6)</td>
<td align="left">4</td>
<td align="right">17</td>
<td align="right">25</td>
<td align="left">p</td>
<td align="left">midsize</td>
</tr>
<tr class="odd">
<td align="left">audi</td>
<td align="left">a6 quattro</td>
<td align="right">4.2</td>
<td align="right">2008</td>
<td align="right">8</td>
<td align="left">auto(s6)</td>
<td align="left">4</td>
<td align="right">16</td>
<td align="right">23</td>
<td align="left">p</td>
<td align="left">midsize</td>
</tr>
</tbody>
</table></div>
<div class="practice">
<p>Do exercise 7.</p>
</div>
<p>Note that you can emulate <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> in a very straightforward way using single-brackets base R, the main difference is that you need to prefix every column with the table name, so <code>mpg[["class"]]</code> instead of just <code>class</code><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;You can sidestep this issue via &lt;a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/with.html"&gt;with()&lt;/a&gt; function, although I am not a big fan of this approach.&lt;/p&gt;'><sup>51</sup></a>.</p>
<div class="sourceCode" id="cb290"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mpg</span><span class="op">[</span><span class="va">mpg</span><span class="op">[[</span><span class="st">"class"</span><span class="op">]</span><span class="op">]</span> <span class="op">==</span> <span class="st">"midsize"</span> <span class="op">&amp;</span> <span class="va">mpg</span><span class="op">[[</span><span class="st">"drv"</span><span class="op">]</span><span class="op">]</span> <span class="op">==</span> <span class="st">"4"</span>, <span class="op">]</span></span></code></pre></div>
<div class="inline-table"><table style="width:100%;" class="table table-sm">
<colgroup>
<col width="18%">
<col width="15%">
<col width="8%">
<col width="7%">
<col width="5%">
<col width="12%">
<col width="5%">
<col width="5%">
<col width="5%">
<col width="4%">
<col width="11%">
</colgroup>
<thead><tr class="header">
<th align="left">manufacturer</th>
<th align="left">model</th>
<th align="right">displ</th>
<th align="right">year</th>
<th align="right">cyl</th>
<th align="left">trans</th>
<th align="left">drv</th>
<th align="right">cty</th>
<th align="right">hwy</th>
<th align="left">fl</th>
<th align="left">class</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">audi</td>
<td align="left">a6 quattro</td>
<td align="right">2.8</td>
<td align="right">1999</td>
<td align="right">6</td>
<td align="left">auto(l5)</td>
<td align="left">4</td>
<td align="right">15</td>
<td align="right">24</td>
<td align="left">p</td>
<td align="left">midsize</td>
</tr>
<tr class="even">
<td align="left">audi</td>
<td align="left">a6 quattro</td>
<td align="right">3.1</td>
<td align="right">2008</td>
<td align="right">6</td>
<td align="left">auto(s6)</td>
<td align="left">4</td>
<td align="right">17</td>
<td align="right">25</td>
<td align="left">p</td>
<td align="left">midsize</td>
</tr>
<tr class="odd">
<td align="left">audi</td>
<td align="left">a6 quattro</td>
<td align="right">4.2</td>
<td align="right">2008</td>
<td align="right">8</td>
<td align="left">auto(s6)</td>
<td align="left">4</td>
<td align="right">16</td>
<td align="right">23</td>
<td align="left">p</td>
<td align="left">midsize</td>
</tr>
</tbody>
</table></div>
<p>So why use <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> then? In isolation, as a single line computation, both options are equally compact and clear (apart from all the extra <code>table[["..."]]</code> in base R). But pipe-oriented nature of the <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> makes it more suitable for chains of computations, which is the main advantage of Tidyverse.</p>
</div>
<div id="arrange-rows-in-a-particular-order" class="section level2" number="6.6">
<h2>
<span class="header-section-number">6.6</span> <code>arrange()</code> rows in a particular order<a class="anchor" aria-label="anchor" href="#arrange-rows-in-a-particular-order"><i class="fas fa-link"></i></a>
</h2>
<p>Sometimes you might need to sort your table so that rows go in a particular order<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;In my experience, this mostly happens when you need to print out or view a table.&lt;/p&gt;"><sup>52</sup></a>. In Tidyverse, you <a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a> rows based on values of specific variables. This verb is very straightforward, you simply list all variables, which must be used for sorting, in the order the sorting must be carried out. I.e., first the table is sorted based on values of the first variable. Then, for equal values of that variable, rows are sorted based on the second variable, etc. By default, rows are arranged in ascending order but you can reverse it by putting a variable inside of <a href="https://dplyr.tidyverse.org/reference/desc.html">desc()</a> function. Here is the <code>short_mpg</code> table arranged by city cycle highway efficiency (ascending order) and engine displacement (descending order, note the order of the last two rows).</p>
<div class="sourceCode" id="cb291"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">short_mpg</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">cty</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">displ</span><span class="op">)</span><span class="op">)</span> </span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<colgroup>
<col width="19%">
<col width="8%">
<col width="8%">
<col width="7%">
<col width="5%">
<col width="16%">
<col width="5%">
<col width="5%">
<col width="5%">
<col width="4%">
<col width="11%">
</colgroup>
<thead><tr class="header">
<th align="left">manufacturer</th>
<th align="left">model</th>
<th align="right">displ</th>
<th align="right">year</th>
<th align="right">cyl</th>
<th align="left">trans</th>
<th align="left">drv</th>
<th align="right">cty</th>
<th align="right">hwy</th>
<th align="left">fl</th>
<th align="left">class</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">audi</td>
<td align="left">a4</td>
<td align="right">2.8</td>
<td align="right">1999</td>
<td align="right">6</td>
<td align="left">auto(l5)</td>
<td align="left">f</td>
<td align="right">16</td>
<td align="right">26</td>
<td align="left">p</td>
<td align="left">compact</td>
</tr>
<tr class="even">
<td align="left">audi</td>
<td align="left">a4</td>
<td align="right">1.8</td>
<td align="right">1999</td>
<td align="right">4</td>
<td align="left">auto(l5)</td>
<td align="left">f</td>
<td align="right">18</td>
<td align="right">29</td>
<td align="left">p</td>
<td align="left">compact</td>
</tr>
<tr class="odd">
<td align="left">audi</td>
<td align="left">a4</td>
<td align="right">2.0</td>
<td align="right">2008</td>
<td align="right">4</td>
<td align="left">manual(m6)</td>
<td align="left">f</td>
<td align="right">20</td>
<td align="right">31</td>
<td align="left">p</td>
<td align="left">compact</td>
</tr>
<tr class="even">
<td align="left">audi</td>
<td align="left">a4</td>
<td align="right">2.0</td>
<td align="right">2008</td>
<td align="right">4</td>
<td align="left">auto(av)</td>
<td align="left">f</td>
<td align="right">21</td>
<td align="right">30</td>
<td align="left">p</td>
<td align="left">compact</td>
</tr>
<tr class="odd">
<td align="left">audi</td>
<td align="left">a4</td>
<td align="right">1.8</td>
<td align="right">1999</td>
<td align="right">4</td>
<td align="left">manual(m5)</td>
<td align="left">f</td>
<td align="right">21</td>
<td align="right">29</td>
<td align="left">p</td>
<td align="left">compact</td>
</tr>
</tbody>
</table></div>
<div class="practice">
<p>Do exercise 8.</p>
</div>
<p>You can arrange a table using base R via <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/order.html">order()</a> function that gives index of ordered elements and can be used inside of preserving subsetting via single brackets <code>[]</code> notation. You can control for ascending/descending of a specific variable using <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/rev.html">rev()</a> function that is applied <em>after</em> ordering, so <code>rev(order(...))</code>.</p>
<div class="sourceCode" id="cb292"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">short_mpg</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="va">short_mpg</span><span class="op">[[</span><span class="st">"cty"</span><span class="op">]</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="va">short_mpg</span><span class="op">[[</span><span class="st">"displ"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<colgroup>
<col width="19%">
<col width="8%">
<col width="8%">
<col width="7%">
<col width="5%">
<col width="16%">
<col width="5%">
<col width="5%">
<col width="5%">
<col width="4%">
<col width="11%">
</colgroup>
<thead><tr class="header">
<th align="left">manufacturer</th>
<th align="left">model</th>
<th align="right">displ</th>
<th align="right">year</th>
<th align="right">cyl</th>
<th align="left">trans</th>
<th align="left">drv</th>
<th align="right">cty</th>
<th align="right">hwy</th>
<th align="left">fl</th>
<th align="left">class</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">audi</td>
<td align="left">a4</td>
<td align="right">2.8</td>
<td align="right">1999</td>
<td align="right">6</td>
<td align="left">auto(l5)</td>
<td align="left">f</td>
<td align="right">16</td>
<td align="right">26</td>
<td align="left">p</td>
<td align="left">compact</td>
</tr>
<tr class="even">
<td align="left">audi</td>
<td align="left">a4</td>
<td align="right">1.8</td>
<td align="right">1999</td>
<td align="right">4</td>
<td align="left">auto(l5)</td>
<td align="left">f</td>
<td align="right">18</td>
<td align="right">29</td>
<td align="left">p</td>
<td align="left">compact</td>
</tr>
<tr class="odd">
<td align="left">audi</td>
<td align="left">a4</td>
<td align="right">2.0</td>
<td align="right">2008</td>
<td align="right">4</td>
<td align="left">manual(m6)</td>
<td align="left">f</td>
<td align="right">20</td>
<td align="right">31</td>
<td align="left">p</td>
<td align="left">compact</td>
</tr>
<tr class="even">
<td align="left">audi</td>
<td align="left">a4</td>
<td align="right">2.0</td>
<td align="right">2008</td>
<td align="right">4</td>
<td align="left">auto(av)</td>
<td align="left">f</td>
<td align="right">21</td>
<td align="right">30</td>
<td align="left">p</td>
<td align="left">compact</td>
</tr>
<tr class="odd">
<td align="left">audi</td>
<td align="left">a4</td>
<td align="right">1.8</td>
<td align="right">1999</td>
<td align="right">4</td>
<td align="left">manual(m5)</td>
<td align="left">f</td>
<td align="right">21</td>
<td align="right">29</td>
<td align="left">p</td>
<td align="left">compact</td>
</tr>
</tbody>
</table></div>
<div class="practice">
<p>Do exercise 9.</p>
</div>
</div>
<div id="mutate" class="section level2" number="6.7">
<h2>
<span class="header-section-number">6.7</span> <code>mutate()</code> columns<a class="anchor" aria-label="anchor" href="#mutate"><i class="fas fa-link"></i></a>
</h2>
<p>In Tidyverse, <a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a> function allows you to both add new columns/variables to a table and change the existing ones. In essence, it is equivalent to a simple column assignment statement in base R.</p>
<div class="sourceCode" id="cb293"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># base R</span></span>
<span><span class="va">short_mpg</span><span class="op">[[</span><span class="st">"avg_mpg"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">short_mpg</span><span class="op">[[</span><span class="st">"cty"</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> <span class="va">short_mpg</span><span class="op">[[</span><span class="st">"hwy"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span></span>
<span></span>
<span><span class="co"># Tidyverse equivalent</span></span>
<span><span class="va">short_mpg</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">short_mpg</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>avg_mpg <span class="op">=</span> <span class="op">(</span><span class="va">cty</span> <span class="op">+</span> <span class="va">hwy</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p>Note two critical differences. First, <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> takes a table as an input and returns a table as an output. This is why you start with a table, pipe it to mutate, and assign the results <em>back</em> to the original variable. If you have more verbs/lines, it is the output of the <em>last</em> computation that is assigned to the variable on the left-hand side of assignment<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;R does have &lt;code&gt;-&amp;gt;&lt;/code&gt; statement, so, technically, you can pipe your computation and then assign it to a variable &lt;code&gt;table |&amp;gt; mutate() -&amp;gt; table&lt;/code&gt;. However, this style is generally discouraged as starting with &lt;code&gt;table &amp;lt;- table |&amp;gt;&lt;/code&gt; makes it clear that you modify and store the computation, whereas &lt;code&gt;table |&amp;gt;&lt;/code&gt; signals that you pipe the results to an output: console, printed-out table, plot, etc.&lt;/p&gt;"><sup>53</sup></a>. Look at the listing below that indexes each line by when it is executed.</p>
<div class="sourceCode" id="cb294"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">some_table</span> <span class="op">&lt;-</span>    <span class="co"># 3. We assign the result to the original table, only once all the code below has been executed.</span></span>
<span>  <span class="va">some_table</span> <span class="op">|&gt;</span>  <span class="co"># 1. We start here, with the original table and pipe to the next computation</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span>    <span class="co"># 2. We add/change columns inside of the table. The output is a table which we use for assignment all the way at the top.</span></span></code></pre></div>
<p>Second, you are performing a computation <em>inside</em> the call of the <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> function, so <code>avg_mpg = (short_mpg$cty + short_mpg$hwy) / 2</code> is a <em>parameter</em> that you pass to it (yes, it does not look like one). This is why you use <code>=</code> rather than a normal assignment arrow <code>&lt;-</code>. Unfortunately, you <em>can</em> use <code>&lt;-</code> inside the <code>mutate</code> and the computation will work as intended but, for internal-processing reasons, the <em>entire statement</em>, rather than just the left-hand side, will be used as a column name. Thus, use <code>&lt;-</code> <em>outside</em> and <code>=</code> <em>inside</em> of Tydiverse verbs.</p>
<div class="sourceCode" id="cb295"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">short_mpg</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">cty</span>, <span class="va">hwy</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>avg_mpg <span class="op">=</span>  <span class="op">(</span><span class="va">cty</span> <span class="op">+</span> <span class="va">hwy</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span>,      <span class="co"># column name will be avp_mpg</span></span>
<span>         <span class="va">avg_mpg</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">cty</span> <span class="op">+</span> <span class="va">hwy</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span>  <span class="co"># column name will be `avg_mpg &lt;- (short_mpg$cty + short_mpg$hwy) / 2`</span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="right">cty</th>
<th align="right">hwy</th>
<th align="right">avg_mpg</th>
<th align="right">avg_mpg &lt;- (cty + hwy)/2</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">18</td>
<td align="right">29</td>
<td align="right">23.5</td>
<td align="right">23.5</td>
</tr>
<tr class="even">
<td align="right">21</td>
<td align="right">29</td>
<td align="right">25.0</td>
<td align="right">25.0</td>
</tr>
<tr class="odd">
<td align="right">20</td>
<td align="right">31</td>
<td align="right">25.5</td>
<td align="right">25.5</td>
</tr>
<tr class="even">
<td align="right">21</td>
<td align="right">30</td>
<td align="right">25.5</td>
<td align="right">25.5</td>
</tr>
<tr class="odd">
<td align="right">16</td>
<td align="right">26</td>
<td align="right">21.0</td>
<td align="right">21.0</td>
</tr>
</tbody>
</table></div>
<p>As shown in the example above, you can perform several computations within a single <code>mutate</code> call and they are executed one after another, just as they would be when using base R.</p>
<div class="practice">
<p>Do exercise 10.</p>
</div>
<p>Finally, <code>mutate</code> has two cousin-verbs called <a href="https://dplyr.tidyverse.org/reference/transmute.html?q=transmute">transmute</a> and <a href="https://tibble.tidyverse.org/reference/add_column.html">add_column</a>. The former — <code>transmute</code> — works the same way but <em>discards</em> all original columns that were not modified. You probably won’t use this verb all too often but I want you to be able to recognize it, as its name and function are very similar to <code>mutate</code> and the two are easy to confuse.</p>
<div class="sourceCode" id="cb296"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">short_mpg</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/transmute.html">transmute</a></span><span class="op">(</span>avg_mpg <span class="op">=</span> <span class="op">(</span><span class="va">cty</span> <span class="op">+</span> <span class="va">hwy</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span>align <span class="op">=</span> <span class="st">"c"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="center">avg_mpg</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">23.5</td>
</tr>
<tr class="even">
<td align="center">25.0</td>
</tr>
<tr class="odd">
<td align="center">25.5</td>
</tr>
<tr class="even">
<td align="center">25.5</td>
</tr>
<tr class="odd">
<td align="center">21.0</td>
</tr>
</tbody>
</table></div>
<p>The latter — <code>add_column</code> — is <em>similar</em> to <code>mutate</code> if you need to add a new column rather than to modify a new one. Its advantage is that it will produce an error, if you try to overwrite an existing column. Its disadvantage is that it does not appear to respect data grouping (see below), which can be very confusing. In short, stick to <code>mutate</code> unless you need either of these two functions specifically.</p>
</div>
<div id="summarize" class="section level2" number="6.8">
<h2>
<span class="header-section-number">6.8</span> <code>summarize()</code> table<a class="anchor" aria-label="anchor" href="#summarize"><i class="fas fa-link"></i></a>
</h2>
<p>This verb is used when you <em>aggregate</em> across <em>all</em> rows, reducing them to a <em>single value</em>. Some examples of aggregating functions that are probably already familiar to you are <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/mean.html">mean</a>, <a href="https://stat.ethz.ch/R-manual/R-devel/library/stats/html/median.html">median</a>, <a href="https://stat.ethz.ch/R-manual/R-devel/library/stats/html/sd.html">standard deviation</a>, <a href="https://stat.ethz.ch/R-manual/R-patched/library/base/html/Extremes.html">min/max</a>. However, you can “aggregate” by taking a first or a last value or even by putting in a constant. Important is that you should assign a <em>single</em> value to the column when using <code>summarize</code>.</p>
<p>If you use <code>summarize</code> on an <em>ungrouped</em> table (these are the only tables we’ve been working on so far), it keeps only the computed columns, which makes you wonder “what’s the point?”</p>
<div class="sourceCode" id="cb297"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mpg</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>avg_cty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">cty</span><span class="op">)</span>,</span>
<span>            avg_hwy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">hwy</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##   avg_cty avg_hwy
##     &lt;dbl&gt;   &lt;dbl&gt;
## 1    16.9    23.4</code></pre>
</div>
<div id="group_by" class="section level2" number="6.9">
<h2>
<span class="header-section-number">6.9</span> Work on individual groups of rows<a class="anchor" aria-label="anchor" href="#group_by"><i class="fas fa-link"></i></a>
</h2>
<p>The real power of <code>summarize</code> and of <code>mutate</code> becomes evident when they are applied to the data that is <em>grouped by</em> certain criteria. <a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a> verb groups rows of the table based on values of variables you specified. Behind the scenes, this turns your single table into set of tables, so that your Tidyverse verbs are applied to <em>each</em> table <em>separately</em>. This ability to parse your table into different groups of rows (all rows that belong to a particular participant, or participant and condition, or rows per block, or per trial), change that grouping on the fly, return back to the original full table, etc. makes analysis a breeze. Here is how we can compute average efficiency not across all cars (as in the code above) but for each car class separately.</p>
<div class="sourceCode" id="cb299"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mpg</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># there are seven different classes of cars, so group_by(cars)  will</span></span>
<span>  <span class="co"># create seven hidden independent tables and all verbs below will be </span></span>
<span>  <span class="co"># applied to each table separately</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">class</span><span class="op">)</span>  <span class="op">|&gt;</span></span>
<span>  </span>
<span>  <span class="co"># same mean computation but per table and we've got seven of them</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>avg_cty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">cty</span><span class="op">)</span>,</span>
<span>            avg_hwy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">hwy</span><span class="op">)</span>,</span>
<span>            .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">class</th>
<th align="right">avg_cty</th>
<th align="right">avg_hwy</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">2seater</td>
<td align="right">15.40000</td>
<td align="right">24.80000</td>
</tr>
<tr class="even">
<td align="left">compact</td>
<td align="right">20.12766</td>
<td align="right">28.29787</td>
</tr>
<tr class="odd">
<td align="left">midsize</td>
<td align="right">18.75610</td>
<td align="right">27.29268</td>
</tr>
<tr class="even">
<td align="left">minivan</td>
<td align="right">15.81818</td>
<td align="right">22.36364</td>
</tr>
<tr class="odd">
<td align="left">pickup</td>
<td align="right">13.00000</td>
<td align="right">16.87879</td>
</tr>
<tr class="even">
<td align="left">subcompact</td>
<td align="right">20.37143</td>
<td align="right">28.14286</td>
</tr>
<tr class="odd">
<td align="left">suv</td>
<td align="right">13.50000</td>
<td align="right">18.12903</td>
</tr>
</tbody>
</table></div>
<p>Note that we compute a <em>single</em> value per table but because we do it for <em>seven tables</em>, we get <em>seven rows</em> in our resultant table. And <code>group_by</code> makes it easy to group data in any way you want. Are you interested in manufacturers instead car classes? Easy!</p>
<div class="sourceCode" id="cb300"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mpg</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">manufacturer</span><span class="op">)</span>  <span class="op">|&gt;</span></span>
<span>  <span class="co"># same mean computation but per table and we've got seven of them</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>avg_cty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">cty</span><span class="op">)</span>,</span>
<span>            avg_hwy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">hwy</span><span class="op">)</span>,</span>
<span>            .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">manufacturer</th>
<th align="right">avg_cty</th>
<th align="right">avg_hwy</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">audi</td>
<td align="right">17.61111</td>
<td align="right">26.44444</td>
</tr>
<tr class="even">
<td align="left">chevrolet</td>
<td align="right">15.00000</td>
<td align="right">21.89474</td>
</tr>
<tr class="odd">
<td align="left">dodge</td>
<td align="right">13.13514</td>
<td align="right">17.94595</td>
</tr>
<tr class="even">
<td align="left">ford</td>
<td align="right">14.00000</td>
<td align="right">19.36000</td>
</tr>
<tr class="odd">
<td align="left">honda</td>
<td align="right">24.44444</td>
<td align="right">32.55556</td>
</tr>
<tr class="even">
<td align="left">hyundai</td>
<td align="right">18.64286</td>
<td align="right">26.85714</td>
</tr>
<tr class="odd">
<td align="left">jeep</td>
<td align="right">13.50000</td>
<td align="right">17.62500</td>
</tr>
<tr class="even">
<td align="left">land rover</td>
<td align="right">11.50000</td>
<td align="right">16.50000</td>
</tr>
<tr class="odd">
<td align="left">lincoln</td>
<td align="right">11.33333</td>
<td align="right">17.00000</td>
</tr>
<tr class="even">
<td align="left">mercury</td>
<td align="right">13.25000</td>
<td align="right">18.00000</td>
</tr>
<tr class="odd">
<td align="left">nissan</td>
<td align="right">18.07692</td>
<td align="right">24.61538</td>
</tr>
<tr class="even">
<td align="left">pontiac</td>
<td align="right">17.00000</td>
<td align="right">26.40000</td>
</tr>
<tr class="odd">
<td align="left">subaru</td>
<td align="right">19.28571</td>
<td align="right">25.57143</td>
</tr>
<tr class="even">
<td align="left">toyota</td>
<td align="right">18.52941</td>
<td align="right">24.91176</td>
</tr>
<tr class="odd">
<td align="left">volkswagen</td>
<td align="right">20.92593</td>
<td align="right">29.22222</td>
</tr>
</tbody>
</table></div>
<p>How about efficiency per class <em>and</em> year? Still easy!</p>
<div class="sourceCode" id="cb301"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mpg</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">class</span>, <span class="va">year</span><span class="op">)</span>  <span class="op">|&gt;</span></span>
<span>  <span class="co"># same mean computation but per table and we've got seven of them</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>avg_cty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">cty</span><span class="op">)</span>,</span>
<span>            avg_hwy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">hwy</span><span class="op">)</span>,</span>
<span>            .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">class</th>
<th align="right">year</th>
<th align="right">avg_cty</th>
<th align="right">avg_hwy</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">2seater</td>
<td align="right">1999</td>
<td align="right">15.50000</td>
<td align="right">24.50000</td>
</tr>
<tr class="even">
<td align="left">2seater</td>
<td align="right">2008</td>
<td align="right">15.33333</td>
<td align="right">25.00000</td>
</tr>
<tr class="odd">
<td align="left">compact</td>
<td align="right">1999</td>
<td align="right">19.76000</td>
<td align="right">27.92000</td>
</tr>
<tr class="even">
<td align="left">compact</td>
<td align="right">2008</td>
<td align="right">20.54545</td>
<td align="right">28.72727</td>
</tr>
<tr class="odd">
<td align="left">midsize</td>
<td align="right">1999</td>
<td align="right">18.15000</td>
<td align="right">26.50000</td>
</tr>
<tr class="even">
<td align="left">midsize</td>
<td align="right">2008</td>
<td align="right">19.33333</td>
<td align="right">28.04762</td>
</tr>
<tr class="odd">
<td align="left">minivan</td>
<td align="right">1999</td>
<td align="right">16.16667</td>
<td align="right">22.50000</td>
</tr>
<tr class="even">
<td align="left">minivan</td>
<td align="right">2008</td>
<td align="right">15.40000</td>
<td align="right">22.20000</td>
</tr>
<tr class="odd">
<td align="left">pickup</td>
<td align="right">1999</td>
<td align="right">13.00000</td>
<td align="right">16.81250</td>
</tr>
<tr class="even">
<td align="left">pickup</td>
<td align="right">2008</td>
<td align="right">13.00000</td>
<td align="right">16.94118</td>
</tr>
<tr class="odd">
<td align="left">subcompact</td>
<td align="right">1999</td>
<td align="right">21.57895</td>
<td align="right">29.00000</td>
</tr>
<tr class="even">
<td align="left">subcompact</td>
<td align="right">2008</td>
<td align="right">18.93750</td>
<td align="right">27.12500</td>
</tr>
<tr class="odd">
<td align="left">suv</td>
<td align="right">1999</td>
<td align="right">13.37931</td>
<td align="right">17.55172</td>
</tr>
<tr class="even">
<td align="left">suv</td>
<td align="right">2008</td>
<td align="right">13.60606</td>
<td align="right">18.63636</td>
</tr>
</tbody>
</table></div>
<p>The <code>.groups</code> parameter of the summarize function determines whether grouping you use should be dropped (<code>.groups = "drop"</code>, table become a single ungrouped table) or kept (<code>.groups = "keep"</code>). You will get a warning, if you do not specify <code>.groups</code> parameter, so it is a good idea to do this explicitly. In general, use <code>.groups = "drop"</code> as it is better to later regroup table again then work on a groupped table without realizing it (leads to some weird looking output and a tricky to chase problem). You can also explicitly drop grouping via <a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup()</a> verb.</p>
<p>Finally, there is a cousin verb <a href="https://dplyr.tidyverse.org/reference/rowwise.html">rowwise()</a> that groups by row. I.e., every row of the table becomes its own group, which could be useful if you need to apply a computation per row and the usual <a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a> approach does not work (however, this is something of an advanced topic, so it is more about recognizing it than using it).</p>
<div class="practice">
<p>Do exercise 11.</p>
</div>
<p>You can replicate the functionality of <code>group_by</code> + <code>summarize</code> in base R via <a href="https://stat.ethz.ch/R-manual/R-patched/library/stats/html/aggregate.html">aggregate()</a> and <code>group_by</code> + <code>mutate</code> via <a href="https://stat.ethz.ch/R-manual/R-patched/library/base/html/by.html">by</a> functions. However, they are somewhat less straightforward in use as they rely on functional programming (which you haven’t learned about yet) and require both grouping and summary function within a single call. Hence, we will skip on those.</p>
</div>
<div id="putting-it-all-together" class="section level2" number="6.10">
<h2>
<span class="header-section-number">6.10</span> Putting it all together<a class="anchor" aria-label="anchor" href="#putting-it-all-together"><i class="fas fa-link"></i></a>
</h2>
<p>Now you have enough tools at your disposal to start programming a continuous analysis pipeline!</p>
<div class="practice">
<p>Do exercise 12.</p>
</div>
</div>
<div id="should-i-use-tidyverse" class="section level2" number="6.11">
<h2>
<span class="header-section-number">6.11</span> Should I use Tidyverse?<a class="anchor" aria-label="anchor" href="#should-i-use-tidyverse"><i class="fas fa-link"></i></a>
</h2>
<p>As you saw above, whatever Tidyverse can do, base R can do as well. So why use a non-standard family of packages? If you are using each function in isolation, there is probably not much sense in this. Base R can do it equally well and <em>each individual</em> function is also compact and simple. However, if you need to <em>chain</em> your computation, which is almost always the case, Tidyverse’s ability to pipe the entire sequence of functions in a simple consistent and, therefore, easy to understand way is a game-changer. In the long run, pick your style. Either go “all in” with Tidyverse (that is my approach), stick to base R, or find some alternative package family (e.g., <a href="https://github.com/Rdatatable/data.table">data.table</a>). However, as far as the book is concerned, it will be almost exclusively Tydiverse from now on.</p>

</div>
</div>

  <div class="chapter-nav">
<div class="prev"><a href="ggplot2.html"><span class="header-section-number">5</span> ggplot2: Grammar of Graphics</a></div>
<div class="next"><a href="working-with-factors.html"><span class="header-section-number">7</span> Working with Factors</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#dplyr"><span class="header-section-number">6</span> Tidyverse: dplyr</a></li>
<li><a class="nav-link" href="#tidyverse-philosophy"><span class="header-section-number">6.1</span> Tidyverse philosophy</a></li>
<li><a class="nav-link" href="#select"><span class="header-section-number">6.2</span> select() columns by name</a></li>
<li><a class="nav-link" href="#conditions"><span class="header-section-number">6.3</span> Conditions</a></li>
<li><a class="nav-link" href="#logical-indexing"><span class="header-section-number">6.4</span> Logical indexing</a></li>
<li><a class="nav-link" href="#filter-rows-by-values"><span class="header-section-number">6.5</span> filter() rows by values</a></li>
<li><a class="nav-link" href="#arrange-rows-in-a-particular-order"><span class="header-section-number">6.6</span> arrange() rows in a particular order</a></li>
<li><a class="nav-link" href="#mutate"><span class="header-section-number">6.7</span> mutate() columns</a></li>
<li><a class="nav-link" href="#summarize"><span class="header-section-number">6.8</span> summarize() table</a></li>
<li><a class="nav-link" href="#group_by"><span class="header-section-number">6.9</span> Work on individual groups of rows</a></li>
<li><a class="nav-link" href="#putting-it-all-together"><span class="header-section-number">6.10</span> Putting it all together</a></li>
<li><a class="nav-link" href="#should-i-use-tidyverse"><span class="header-section-number">6.11</span> Should I use Tidyverse?</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/alexander-pastukhov/data-analysis-using-r-for-psychology/blob/master/06-dplyr.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/alexander-pastukhov/data-analysis-using-r-for-psychology/edit/master/06-dplyr.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Data analysis using R for Psychology and Social Science</strong>" was written by Alexander (Sasha) Pastukhov. It was last built on 2023-10-09.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>Please note that this website collects anonymized data via Google analytics. This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
