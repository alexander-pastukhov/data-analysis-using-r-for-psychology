<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 10 Missing data | Data analysis using R for Psychology and Social Science</title>
<meta name="author" content="Alexander (Sasha) Pastukhov">
<meta name="description" content="Grab an exercise notebook before we start! Sometimes data is missing. It can be missing explicitly with NA standing for Not Available / Missing data. Or, it can be missing implicitly when there is...">
<meta name="generator" content="bookdown 0.37 with bs4_book()">
<meta property="og:title" content="Chapter 10 Missing data | Data analysis using R for Psychology and Social Science">
<meta property="og:type" content="book">
<meta property="og:description" content="Grab an exercise notebook before we start! Sometimes data is missing. It can be missing explicitly with NA standing for Not Available / Missing data. Or, it can be missing implicitly when there is...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 10 Missing data | Data analysis using R for Psychology and Social Science">
<meta name="twitter:description" content="Grab an exercise notebook before we start! Sometimes data is missing. It can be missing explicitly with NA standing for Not Available / Missing data. Or, it can be missing implicitly when there is...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.6.1/transition.js"></script><script src="libs/bs3compat-0.6.1/tabs.js"></script><script src="libs/bs3compat-0.6.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><link rel="shortcut icon" href="images/R_course_logo.svg">
<!-- Google tag (gtag.js) --><script async src="https://www.googletagmanager.com/gtag/js?id=G-QMVBLBE7DV"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-QMVBLBE7DV');
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="bs4_style.css">
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Data analysis using R for Psychology and Social Science</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Introduction</a></li>
<li><a class="" href="software.html">Software</a></li>
<li><a class="" href="reproducable-research.html"><span class="header-section-number">1</span> Reproducable Research: Projects and Markdown Notebooks</a></li>
<li><a class="" href="vectors.html"><span class="header-section-number">2</span> Vectors! Vectors everywhere!</a></li>
<li><a class="" href="tables.html"><span class="header-section-number">3</span> Tables and Tibbles (and Tribbles)</a></li>
<li><a class="" href="functions.html"><span class="header-section-number">4</span> Functions! Functions everywhere!</a></li>
<li><a class="" href="ggplot2.html"><span class="header-section-number">5</span> ggplot2: Grammar of Graphics</a></li>
<li><a class="" href="dplyr.html"><span class="header-section-number">6</span> Tidyverse: dplyr</a></li>
<li><a class="" href="working-with-factors.html"><span class="header-section-number">7</span> Working with Factors</a></li>
<li><a class="" href="tyding.html"><span class="header-section-number">8</span> Tidyng your data: joins and pivots</a></li>
<li><a class="" href="control-flow-chapter.html"><span class="header-section-number">9</span> Controling computation flow</a></li>
<li><a class="active" href="missing-data.html"><span class="header-section-number">10</span> Missing data</a></li>
<li><a class="" href="strings.html"><span class="header-section-number">11</span> Working with strings</a></li>
<li><a class="" href="sampling-and-simulations.html"><span class="header-section-number">12</span> Sampling and simulations</a></li>
<li><a class="" href="generalized-linear-regression-and-resampling.html"><span class="header-section-number">13</span> (Generalized) Linear regression and Resampling</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/alexander-pastukhov/data-analysis-using-r-for-psychology">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="missing-data" class="section level1" number="10">
<h1>
<span class="header-section-number">10</span> Missing data<a class="anchor" aria-label="anchor" href="#missing-data"><i class="fas fa-link"></i></a>
</h1>
<p>Grab an <a href="notebooks/Seminar%2011%20-%20missing%20data.Rmd">exercise notebook</a> before we start!</p>
<p>Sometimes data is missing. It can be missing <em>explicitly</em> with <code>NA</code> standing for <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/NA.html">Not Available / Missing</a> data. Or, it can be missing <em>implicitly</em> when there is no entry for a particular condition. In the latter case, the strategy is to make missing values explicit first (discussed below).</p>
<p>Then (once) you have missing values, represented by <code>NA</code> in R, you must decide how to deal with them: you can use this information directly as missing data can be diagnostic in itself, you can impute values using either a sophisticated statistical methods or via a simple average/default value strategy, or you can exclude them from the analysis. Every option has pros and cons, so think carefully and do not use an option <a href="https://www.reddit.com/r/AskStatistics/comments/rvw9ur/is_it_best_to_fill_in_missing_data_with_0s/">whose effects you do not fully understand</a> as it will compromise the rest of your analysis.</p>
<div id="complete" class="section level2" number="10.1">
<h2>
<span class="header-section-number">10.1</span> Making missing data explicit (completing data)<a class="anchor" aria-label="anchor" href="#complete"><i class="fas fa-link"></i></a>
</h2>
To make implicit missing data explicit, <em>tidyr</em> provides a function <a href="https://tidyr.tidyverse.org/reference/complete.html">complete()</a> that you already met. It figures out all combinations of values for columns that you specified, finds missing combinations, and adds them using <code>NA</code> (or some other specified value) for other columns. Imagine a toy incomplete table (no data for Participant <code>2</code> and Face <code>M-2</code>).
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:unnamed-chunk-258">Table 10.1: </span>Table with no data for Face M2 for Participant 2.
</caption>
<thead><tr>
<th style="text-align:right;">
Participant
</th>
<th style="text-align:left;">
Face
</th>
<th style="text-align:right;">
Symmetry
</th>
<th style="text-align:right;">
Attractiveness
</th>
<th style="text-align:right;">
Trustworthiness
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
M-1
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
M-2
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
6
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
M-1
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table></div>
<p>We can <a href="https://tidyr.tidyverse.org/reference/complete.html">complete</a> that table by specifying columns that define all required combinations.</p>
<div class="sourceCode" id="cb434"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">complete_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/complete.html">complete</a></span><span class="op">(</span><span class="va">incomplete_df</span>, <span class="va">Participant</span>, <span class="va">Face</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:unnamed-chunk-260">Table 10.2: </span>Completed table with explicit NAs
</caption>
<thead><tr>
<th style="text-align:right;">
Participant
</th>
<th style="text-align:left;">
Face
</th>
<th style="text-align:right;">
Symmetry
</th>
<th style="text-align:right;">
Attractiveness
</th>
<th style="text-align:right;">
Trustworthiness
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
M-1
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
M-2
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
6
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
M-1
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
M-2
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
</tbody>
</table></div>
<p>For <em>non-factor</em> variables (<code>Participant</code> is numeric and <code>Face</code> is character/string), <a href="https://tidyr.tidyverse.org/reference/complete.html">complete</a> finds all <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/unique.html">unique</a> values for each column and finds all combinations of these elements. However, if a variable is a <a href="working-with-factors.html#factors">factor</a>, <a href="https://tidyr.tidyverse.org/reference/complete.html">complete</a> uses it <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/levels.html">levels</a>, even if not all levels are present in the data. E.g., we can use <code>Face</code> as a factor with three levels: “M-1”, “M-2”, and “F-1”. In this case, information is missing for both participants (neither have responses on face “F-1”) and should be filled with NAs. This approach is useful if you know all combinations that <em>should</em> be present in the data and need to ensure the completeness.</p>
<div class="sourceCode" id="cb435"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">extended_df</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">incomplete_df</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># converting Face to factor with THREE levels (only TWO are present in the data)</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Face <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">Face</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"M-1"</span>, <span class="st">"M-2"</span>, <span class="st">"F-1"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># completing the table</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/complete.html">complete</a></span><span class="op">(</span><span class="va">Participant</span>, <span class="va">Face</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:unnamed-chunk-262">Table 10.3: </span>Completed missing data including F-1 face.
</caption>
<thead><tr>
<th style="text-align:right;">
Participant
</th>
<th style="text-align:left;">
Face
</th>
<th style="text-align:right;">
Symmetry
</th>
<th style="text-align:right;">
Attractiveness
</th>
<th style="text-align:right;">
Trustworthiness
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
M-1
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
M-2
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
6
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
F-1
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
M-1
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
M-2
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
F-1
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
</tbody>
</table></div>
<div class="practice">
<p>Do exercise 1.</p>
</div>
<p>You can also supply default values via <code>fill</code> parameter that takes a <a href="vectors.html#names">named</a> <a href="tables.html#lists">list</a>, e.g., <code>list(column_name = default_value)</code>. However, I’d like to remind you again that you should only impute values that “make sense” given the rest of your analysis. Zeros here are for illustration only and, in a real-life scenario, would ruin your inferences either by artificially lowering symmetry and attractiveness of the second face or (if you are lucky) will break and stop the analysis that expects only values within 1-7 range (rmANOVA won’t be bothered at that would be the first scenario),</p>
<div class="sourceCode" id="cb436"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">filled_df</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">incomplete_df</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/complete.html">complete</a></span><span class="op">(</span><span class="va">Participant</span>, <span class="va">Face</span>, fill<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Attractiveness<span class="op">=</span><span class="fl">0</span>, Symmetry<span class="op">=</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:unnamed-chunk-264">Table 10.4: </span>Completed missing data with non-NA values.
</caption>
<thead><tr>
<th style="text-align:right;">
Participant
</th>
<th style="text-align:left;">
Face
</th>
<th style="text-align:right;">
Symmetry
</th>
<th style="text-align:right;">
Attractiveness
</th>
<th style="text-align:right;">
Trustworthiness
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
M-1
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
M-2
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
6
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
M-1
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
M-2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
NA
</td>
</tr>
</tbody>
</table></div>
<div class="practice">
<p>Do exercise 2.</p>
</div>
<p>The <a href="https://tidyr.tidyverse.org/reference/complete.html">complete()</a> is easy to use convenience function that you can easily replicate yourself. To do this, you need to create a new table that lists all combinations of variables that you are interested in (you can use either <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/expand.grid.html">expand.grid()</a> or <a href="https://tidyr.tidyverse.org/reference/expand_grid.html">expand_grid()</a> for this) and then <a href="tyding.html#joins">left joining</a> the original table to it (why left join? Could you use another join for the same purpose?). The results is the same as with a <a href="https://tidyr.tidyverse.org/reference/complete.html">complete()</a> itself.</p>
<div class="practice">
<p>Do exercise 3.</p>
</div>
</div>
<div id="na.omit" class="section level2" number="10.2">
<h2>
<span class="header-section-number">10.2</span> Dropping / omitting NAs<a class="anchor" aria-label="anchor" href="#na.omit"><i class="fas fa-link"></i></a>
</h2>
<p>There are two approaches for excluding missing values. You can exclude all incomplete rows which have missing values in <em>any</em> variable via <a href="https://stat.ethz.ch/R-manual/R-devel/library/stats/html/na.fail.html">na.omit()</a> (base R function) or <a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na()</a> (<a href="https://tidyr.tidyverse.org/">tidyr</a> package function). Or you can exclude rows only if they have <code>NA</code> in a specific columns by specifying their names.</p>
For a table you see below
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:unnamed-chunk-265">Table 10.5: </span>Table with missing values.
</caption>
<thead><tr>
<th style="text-align:right;">
Participant
</th>
<th style="text-align:left;">
Face
</th>
<th style="text-align:right;">
Symmetry
</th>
<th style="text-align:right;">
Attractiveness
</th>
<th style="text-align:right;">
Trustworthiness
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
M-1
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
M-2
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
M-1
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
M-2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
2
</td>
</tr>
</tbody>
</table></div>
<p>First, we can ensure only complete cases via <a href="https://stat.ethz.ch/R-manual/R-devel/library/stats/html/na.fail.html">na.omit()</a></p>
<div class="sourceCode" id="cb437"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span><span class="op">(</span><span class="va">widish_df_with_NA</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:unnamed-chunk-266">Table 10.6: </span>Complete cases via na.omit()
</caption>
<thead><tr>
<th style="text-align:right;">
Participant
</th>
<th style="text-align:left;">
Face
</th>
<th style="text-align:right;">
Symmetry
</th>
<th style="text-align:right;">
Attractiveness
</th>
<th style="text-align:right;">
Trustworthiness
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
M-1
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
M-2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
2
</td>
</tr>
</tbody>
</table></div>
<p>or via <a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na()</a></p>
<div class="sourceCode" id="cb438"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">widish_df_with_NA</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:unnamed-chunk-267">Table 10.7: </span>Complete cases via drop_na()
</caption>
<thead><tr>
<th style="text-align:right;">
Participant
</th>
<th style="text-align:left;">
Face
</th>
<th style="text-align:right;">
Symmetry
</th>
<th style="text-align:right;">
Attractiveness
</th>
<th style="text-align:right;">
Trustworthiness
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
M-1
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
M-2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
2
</td>
</tr>
</tbody>
</table></div>
<p>Second, we drop rows only if <code>Attractiveness</code> data is missing.</p>
<div class="sourceCode" id="cb439"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">widish_df_with_NA</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="va">Attractiveness</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:unnamed-chunk-268">Table 10.8: </span>Complete Attractiveness via drop_na()
</caption>
<thead><tr>
<th style="text-align:right;">
Participant
</th>
<th style="text-align:left;">
Face
</th>
<th style="text-align:right;">
Symmetry
</th>
<th style="text-align:right;">
Attractiveness
</th>
<th style="text-align:right;">
Trustworthiness
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
M-2
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
M-1
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
M-2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
2
</td>
</tr>
</tbody>
</table></div>
<p>Practice time. Create you own table with missing values and exclude missing values using <a href="https://stat.ethz.ch/R-manual/R-devel/library/stats/html/na.fail.html">na.omit()</a> and <a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na()</a>.</p>
<div class="practice">
<p>Do exercise 4.</p>
</div>
<p><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na()</a> is a very convenient function but you can replicate it functionality using <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/NA.html">is.na()</a> in combination with <a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a> dplyr function or <a href="logical-indexing">logical indexing</a>. Implement code that excludes rows if they contain <code>NA</code> in a specific column using these two approaches.</p>
<div class="practice">
<p>Do exercises 5 and 6.</p>
</div>
<p>Recall that you can write your own functions in R that you can use to create convenience wrappers like <a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na()</a>. Implement code that uses logical indexing as a function that takes table (<code>data.frame</code>) as a first argument and name a of a single column as a second, filters out rows with <code>NA</code> in that column and returns the table back.</p>
<div class="practice">
<p>Do exercise 7.</p>
</div>
<p>As noted above, you can also impute values. The simplest strategy is to use either a fixed or an average (mean, median, etc.) value. <a href="https://tidyr.tidyverse.org/">tidyr</a> function that performs a simple substitution is <a href="https://tidyr.tidyverse.org/reference/replace_na.html">replace_na()</a><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;There is also an inverse function &lt;a href="https://dplyr.tidyverse.org/reference/na_if.html"&gt;na_if()&lt;/a&gt; that converts a specific value to an &lt;code&gt;NA&lt;/code&gt;.&lt;/p&gt;'><sup>67</sup></a> and, as a second parameter, it takes a named list of values <code>list(column_name = value_for_NA)</code>. For our toy table, we can replace missing <code>Attractiveness</code> and <code>Symmetry</code> values with some default value, e.g. <code>0</code> and <code>-1</code> (this is very arbitrary, just to demonstrate how it works, do not do things like these for real analysis unless you know what you are doing!)</p>
<div class="sourceCode" id="cb440"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">widish_df_with_NA</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/replace_na.html">replace_na</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Attractiveness <span class="op">=</span> <span class="fl">0</span>, Symmetry <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> </span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:unnamed-chunk-270">Table 10.9: </span>Missing values filled with 0 and -1
</caption>
<thead><tr>
<th style="text-align:right;">
Participant
</th>
<th style="text-align:left;">
Face
</th>
<th style="text-align:right;">
Symmetry
</th>
<th style="text-align:right;">
Attractiveness
</th>
<th style="text-align:right;">
Trustworthiness
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
M-1
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
M-2
</td>
<td style="text-align:right;">
-1
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
M-1
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
M-2
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
2
</td>
</tr>
</tbody>
</table></div>
<div class="practice">
<p>Do exercise 8.</p>
</div>
<p>Unfortunately, <code><a href="https://tidyr.tidyverse.org/reference/replace_na.html">replace_na()</a></code> works only with constant values and does not handle grouped tables very well<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;At least I wasn’t able to figure out how to do this.&lt;/p&gt;"><sup>68</sup></a> So to replace an <code>NA</code> with a mean value of a <em>grouped</em> data, we need to combine some of our old knowledge with an <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/ifelse.html">ifelse(conditon, value_if_true, value_if_false)</a> function you learned about <a href="control-flow-chapter.html#ifelse">before</a>. Recall that this function is a vectorized cousin of the <a href="control-flow-chapter.html#if-else">if-else</a> that takes 1) a vector of logical values (<code>condition</code>), 2) a vector values that are returned if <code>condition</code> is true, 3) a vector of values that are returned if <code>condition</code> is false. Note that the usual rules of <a href="different-length-vectors">vector length-matching</a> apply, so if the three vectors have different length, they will be automatically (and silently) adjusted to match the length of <code>condition</code> vector. As with all computations, you can use original values themselves. Here is how to replace only negative values but keep the positive ones:</p>
<div class="sourceCode" id="cb441"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">v</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">5</span>, <span class="op">-</span><span class="fl">2</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">v</span> <span class="op">&lt;</span> <span class="fl">0</span>, <span class="fl">0</span>, <span class="va">v</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] 0 3 5 0 5</code></pre>
<p>We, essentially, tell the function, “if the condition is false, use the original value”. Now, your turn! Using the same vector and <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/ifelse.html">ifelse()</a> function, replace negative values with a <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/mean.html">mean</a> value of the positive values in the vector.</p>
<div class="practice">
<p>Do exercise 9.</p>
</div>
<p>Now that you know how to use <code><a href="https://rdrr.io/r/base/ifelse.html">ifelse()</a></code>, replacing <code>NA</code> with a mean will be (relatively) easy. Use <a href="data/adaptation_with_na.csv">adaptation_with_na</a> table and replace missing information using participant-specific values.</p>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:unnamed-chunk-272">Table 10.10: </span>adaptation_with_na.csv with missing values
</caption>
<thead><tr>
<th style="text-align:left;">
Participant
</th>
<th style="text-align:left;">
Prime
</th>
<th style="text-align:left;">
Probe
</th>
<th style="text-align:right;">
Nsame
</th>
<th style="text-align:right;">
Ntotal
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
ma2
</td>
<td style="text-align:left;">
Sphere
</td>
<td style="text-align:left;">
Sphere
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
119
</td>
</tr>
<tr>
<td style="text-align:left;">
ma2
</td>
<td style="text-align:left;">
Sphere
</td>
<td style="text-align:left;">
Quadro
</td>
<td style="text-align:right;">
23
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
ma2
</td>
<td style="text-align:left;">
Sphere
</td>
<td style="text-align:left;">
Dual
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
120
</td>
</tr>
<tr>
<td style="text-align:left;">
ma2
</td>
<td style="text-align:left;">
Sphere
</td>
<td style="text-align:left;">
Single
</td>
<td style="text-align:right;">
31
</td>
<td style="text-align:right;">
115
</td>
</tr>
<tr>
<td style="text-align:left;">
ma2
</td>
<td style="text-align:left;">
Quadro
</td>
<td style="text-align:left;">
Sphere
</td>
<td style="text-align:right;">
25
</td>
<td style="text-align:right;">
120
</td>
</tr>
<tr>
<td style="text-align:left;">
ma2
</td>
<td style="text-align:left;">
Quadro
</td>
<td style="text-align:left;">
Quadro
</td>
<td style="text-align:right;">
26
</td>
<td style="text-align:right;">
120
</td>
</tr>
</tbody>
</table></div>
We have missing data in different columns, so we have to use different for each case. Here is one way to approach this problem. We cannot know the number of trials for a specific Prime × Probe combination, but we can replace missing values for <code>Ntotal</code> with a participant-specific <a href="https://stat.ethz.ch/R-manual/R-devel/library/stats/html/median.html">median</a> value (a “typical” and integer number of trials but do not forget about <code>na.rm</code> option, see manual for details). <code>Nsame</code> is trickier. For this, compute proportion of same response for each condition <code>Psame = Nsame / Ntotal</code>. This will produce missing values whenever <code>Nsame</code> is missing. Now, replace missing <code>Psame</code> values (<a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/NA.html">is.na()</a>) with a mean <code>Psame</code> <em>per participant</em> (again, watch our for <code>na.rm</code>!) using <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/ifelse.html">ifelse()</a> (you can use it inside <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>). Finally, compute missing values for <code>Nsame</code> from <code>Psame</code> and <code>Ntotal</code> (do not forget to round them, so you end up with integer number of trials). This entire computation should be implemented as a single pipeline. You will end up with a following table.
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:unnamed-chunk-273">Table 10.11: </span>adaptation_with_na.csv with imputed values
</caption>
<thead><tr>
<th style="text-align:left;">
Participant
</th>
<th style="text-align:left;">
Prime
</th>
<th style="text-align:left;">
Probe
</th>
<th style="text-align:right;">
Nsame
</th>
<th style="text-align:right;">
Ntotal
</th>
<th style="text-align:right;">
Psame
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
ma2
</td>
<td style="text-align:left;">
Sphere
</td>
<td style="text-align:left;">
Sphere
</td>
<td style="text-align:right;">
36
</td>
<td style="text-align:right;">
119
</td>
<td style="text-align:right;">
0.2983741
</td>
</tr>
<tr>
<td style="text-align:left;">
ma2
</td>
<td style="text-align:left;">
Sphere
</td>
<td style="text-align:left;">
Quadro
</td>
<td style="text-align:right;">
23
</td>
<td style="text-align:right;">
120
</td>
<td style="text-align:right;">
0.1916667
</td>
</tr>
<tr>
<td style="text-align:left;">
ma2
</td>
<td style="text-align:left;">
Sphere
</td>
<td style="text-align:left;">
Dual
</td>
<td style="text-align:right;">
36
</td>
<td style="text-align:right;">
120
</td>
<td style="text-align:right;">
0.2983741
</td>
</tr>
<tr>
<td style="text-align:left;">
ma2
</td>
<td style="text-align:left;">
Sphere
</td>
<td style="text-align:left;">
Single
</td>
<td style="text-align:right;">
31
</td>
<td style="text-align:right;">
115
</td>
<td style="text-align:right;">
0.2695652
</td>
</tr>
<tr>
<td style="text-align:left;">
ma2
</td>
<td style="text-align:left;">
Quadro
</td>
<td style="text-align:left;">
Sphere
</td>
<td style="text-align:right;">
25
</td>
<td style="text-align:right;">
120
</td>
<td style="text-align:right;">
0.2083333
</td>
</tr>
<tr>
<td style="text-align:left;">
ma2
</td>
<td style="text-align:left;">
Quadro
</td>
<td style="text-align:left;">
Quadro
</td>
<td style="text-align:right;">
26
</td>
<td style="text-align:right;">
120
</td>
<td style="text-align:right;">
0.2166667
</td>
</tr>
</tbody>
</table></div>
<div class="practice">
<p>Do exercise 10.</p>
</div>

</div>
</div>

  <div class="chapter-nav">
<div class="prev"><a href="control-flow-chapter.html"><span class="header-section-number">9</span> Controling computation flow</a></div>
<div class="next"><a href="strings.html"><span class="header-section-number">11</span> Working with strings</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#missing-data"><span class="header-section-number">10</span> Missing data</a></li>
<li><a class="nav-link" href="#complete"><span class="header-section-number">10.1</span> Making missing data explicit (completing data)</a></li>
<li><a class="nav-link" href="#na.omit"><span class="header-section-number">10.2</span> Dropping / omitting NAs</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/alexander-pastukhov/data-analysis-using-r-for-psychology/blob/master/11-missing-data.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/alexander-pastukhov/data-analysis-using-r-for-psychology/edit/master/11-missing-data.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Data analysis using R for Psychology and Social Science</strong>" was written by Alexander (Sasha) Pastukhov. It was last built on 2024-01-17.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>Please note that this website collects anonymized data via Google analytics. This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
